(("undefined"!==typeof self?self:this)["webpackJsonpcreneauxMylittlepressing"]=("undefined"!==typeof self?self:this)["webpackJsonpcreneauxMylittlepressing"]||[]).push([[6],{5772:function(e,t,o){},bc7a:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("mapgoogle",{ref:"mapgoogle",attrs:{configs:e.configs,"etape-checkout":e.etapeCheckout,"action-after":e.actionAfter},on:{update_location:e.update_location}})},a=[],n=o("5530"),s=o("b51a"),r=o("b787"),l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("section",{staticClass:"modal micromodal-slide",attrs:{id:"map-popup-wbu"}},[o("div",{staticClass:"modal__overlay"},[o("div",{staticClass:"modal__container",attrs:{role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"}},[o("header",{staticClass:"modal__header"},[o("h2",{staticClass:"modal__title",attrs:{id:"modal-1-title"}},[e._v(" "+e._s(e.configs.titre_map.value)+" ")]),o("a",{staticClass:"modal__close",attrs:{href:"#",rel:"modal:close"},on:{click:function(t){return e.micromodal.close("map-popup-wbu")}}})]),o("main",{staticClass:"modal__content",attrs:{id:"modal-1-content"}},[o("div",{staticClass:"m-0 p-0 container-map"},[o("div",{attrs:{id:"map-display-wbu"}}),o("div",{staticClass:"text-over-lay"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.current_address,expression:"current_address"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.placeholder,id:"map-input-over"},domProps:{value:e.current_address},on:{input:function(t){t.target.composing||(e.current_address=t.target.value)}}})]),o("div",{staticClass:"center-marker"}),o("div",{staticClass:"address-confirm"},[o("button",{staticClass:"btn btn-lg bg-cl1",on:{click:e.save_localisation_cookie}},[e._v(" Confirmer l'adresse ")])])])])])])])])},c=[],p=(o("4f27"),o("2311"),o("977c"),o("13eb"),o("c10f"),o("dcbb"),o("43c9"),o("0202"),o("39e3"),o("ab51"),o("7eb8"),o("06d1")),d={apiKey:"AIzaSyDurloZ0-xj8CNrQwkeSc53A-_n35Xji2Y",GoogleObejct:null,createGoogleObject:function(){var e=this,t=new p["a"]({apiKey:this.apiKey,version:"weekly",libraries:["places","geometry"]});return new Promise((function(o){t.load().then((function(t){e.GoogleObejct=t,o(t)})).catch((function(e){console.log("Erreur initialisation de la MAP : ",e)}))}))},extractPathForPolygon:function(e){var t=JSON.parse(e),o=[];if(t.features&&t.features[0]&&t.features[0].geometry&&t.features[0].geometry.coordinates)for(var i in t.features[0].geometry.coordinates[0]){var a=t.features[0].geometry.coordinates[0][i];o.push({lat:a[1],lng:a[0]})}return o},convertNewLineToArray:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\n";return e.split(t).map((function(e){return e.trim()}))}},u=o("7563"),_={name:"Mapgoogle",props:{configs:{type:Object,required:!0},displayMarker:{type:Boolean,default:!0},image:{type:String,default:"/localisation/img/marker.png"},urlGood:{type:String,default:"/cart"},urlBad:{type:String,default:"/pages/map-error"},etapeCheckout:{type:Boolean,default:!0},actionAfter:{type:Boolean,default:!1}},data:function(){return{id_html:"map-google-field",villes:d.convertNewLineToArray(this.configs.villes.value,";"),list_box:d.convertNewLineToArray(this.configs.bps.value),micromodal:u["a"],map:null,lat:45.7941459,lon:4.68941940000002,point_in_polygon:!1,point_in_ville:!1,point_in_box:!1,titre_popup:"Merci de confirmer votre adresse",current_address:"",valide_text:"Commander maintenant",placeholder:"Entrez votre adresse"}},mounted:function(){this.point_in_box=!1,this.point_in_polygon=!1,this.point_in_ville=!1,this.createGoogleObject(),this.current_address=this.$store.state.location.current_address?this.$store.state.location.current_address:""},methods:{openPopupMap:function(){this.micromodal.show("map-popup-wbu")},closePopupMap:function(){this.micromodal.close("map-popup-wbu")},createGoogleObject:function(){var e=this;d.createGoogleObject().then((function(t){e.GoogleObejct=t,e.getPlace(),e.initMap(),e.geocoder=new e.GoogleObejct.maps.Geocoder}))},getPlace:function(){var e=this,t=document.querySelector("#map-input-over");this.options={componentRestrictions:{country:["fr"]},types:["address"],strictBounds:!0};var o=new this.GoogleObejct.maps.places.Autocomplete(t,this.options);this.GoogleObejct.maps.event.addListener(o,"place_changed",(function(){var t=o.getPlace();t&&t.formatted_address&&(e.current_address=t.formatted_address,e.city_on_map=t.vicinity,e.updateMap(t),e.openPopupMap())}))},initMap:function(){var e=this,t=this.lat,o=this.lon;this.map=new this.GoogleObejct.maps.Map(document.getElementById("map-display-wbu"),{center:new this.GoogleObejct.maps.LatLng(t,o),zoom:17,mapTypeId:this.GoogleObejct.maps.MapTypeId.ROADMAP,mapTypeControl:!1,scrollwheel:!1,mapTypeControlOptions:{style:this.GoogleObejct.maps.MapTypeControlStyle.HORIZONTAL_BAR},navigationControl:!1,panControl:!1,zoomControl:!0,streetViewControl:!1,fullscreenControl:!1,navigationControlOptions:{style:this.GoogleObejct.maps.NavigationControlStyle.ZOOM_PAN},styles:[{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#b8cb92"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#ece2d9"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]}]}),this.setMarker(),this.map.addListener("dragend",(function(){window.setTimeout((function(){var t=e.map.getCenter();t&&(e.lat=t.lat(),e.lon=t.lng(),e.city_on_map="",e.obtenir_address_proche())}),1e3)})),this.buildpolygon(),this.valide_selection()},updateMap:function(e){e.geometry&&(this.map.panTo(e.geometry.location),this.lat=e.geometry.location.lat(),this.lon=e.geometry.location.lng(),this.setMarker(),this.valide_selection())},valide_selection:function(){this.check_if_new_adress_in_polygon(),this.check_if_new_adress_in_villes(),this.check_if_new_adress_in_box()},obtenir_address_proche:function(){var e=this,t=new this.GoogleObejct.maps.LatLng(this.lat,this.lon);this.geocoder.geocode({location:t},(function(t,o){"OK"==o&&(e.current_address=t[0].formatted_address,e.updateMap(t[0]),e.getNameVilleFromPlace(t[0]))}))},setMarker:function(){if(!this.displayMarker)return!1;var e=this,t=this.lat,o=this.lon;this.marker=new this.GoogleObejct.maps.Marker({position:{lat:t,lng:o},map:e.map,icon:this.image})},save_localisation_cookie:function(){if(""==this.current_address)return this.$store.dispatch("setLocation",""),alert("Vous devez definir une adresse"),!1;if(this.point_in_polygon&&this.point_in_ville&&this.point_in_box){var e={current_address:this.current_address,city_on_map:this.city_on_map,locality:this.locality,route:this.route};this.$store.dispatch("setLocation",e),this.$emit("update_location",e),this.etapeCheckout?window.location.href=this.urlGood:(document.querySelector(".modal__close").click(),this.actionAfter&&document.querySelector(".button.cart-checkout-custom").click())}else this.$store.dispatch("setLocation",""),window.location.href=this.urlBad},buildpolygon:function(){this.polygon=new this.GoogleObejct.maps.Polygon({path:d.extractPathForPolygon(this.configs.zone_valide.value),geodesic:!0,strokeColor:"#48a0d9",strokeOpacity:.5,strokeWeight:4,fillColor:"#48a0d9",fillOpacity:.15}),this.polygon.setMap(this.map)},check_if_new_adress_in_polygon:function(){var e=new this.GoogleObejct.maps.LatLng(this.lat,this.lon);this.GoogleObejct.maps.geometry.poly.containsLocation(e,this.polygon)?this.point_in_polygon=!0:this.point_in_polygon=!1},check_if_new_adress_in_villes:function(){var e=this,t=function(){var t=!1;if(e.current_address&&e.current_address.length>0){var o=e.current_address.split(",");o[1].length>0&&e.villes.forEach((function(e){o[1].indexOf(e)>=0&&(t=!0)}))}return t};return"polygon_ville"!=this.type_limitation?(this.point_in_ville=!0,!1):this.villes.indexOf(this.city_on_map)>=0||t()?(this.point_in_ville=!0,!0):void(this.point_in_ville=!1)},check_if_new_adress_in_box:function(){var e=this,t=function(){var t=!1;return e.current_address&&e.current_address.length>0&&e.current_address&&e.list_box.forEach((function(o){e.current_address.indexOf(o)>=0&&(t=!0)})),t};return"polygon_box"!=this.type_limitation?(this.point_in_box=!0,!1):t()?(this.point_in_box=!0,!0):(this.point_in_box=!1,!0)},getNameVilleFromPlace:function(e){var t="",o="";if(e.address_components){for(var i in e.address_components){var a=e.address_components[i];a.types&&a.types.includes("locality")&&""==o&&(o=a.long_name),a.types&&a.types.includes("route")&&""==t&&(t=a.long_name)}this.route=t,this.locality=o}}}},h=_,m=o("2877"),f=Object(m["a"])(h,l,c,!1,null,null,null),g=f.exports,y={name:"AppPopUpMap",store:s["a"],props:{etapeCheckout:{type:Boolean,required:!0},actionAfter:{type:Boolean,required:!0}},components:{mapgoogle:g},computed:Object(n["a"])({},Object(r["b"])(["configs"])),methods:{openModal:function(){this.$refs.mapgoogle.openPopupMap()},update_location:function(e){this.$emit("update_location",e)}}},v=y,b=(o("e40d"),Object(m["a"])(v,i,a,!1,null,"6b7adad7",null));t["default"]=b.exports},e40d:function(e,t,o){"use strict";o("5772")}}]);
//# sourceMappingURL=creneauxMylittlepressing.umd.min.6.js.map